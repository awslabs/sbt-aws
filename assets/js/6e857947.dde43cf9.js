"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[246],{2842:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"partners/isv-integrations/amberflo","title":"Amberflo","description":"A cloud-native solution that integrates with SaaS products to enable real-time metering and usage-based billing for GenAI and SaaS applications.","source":"@site/docs/partners/isv-integrations/amberflo.md","sourceDirName":"partners/isv-integrations","slug":"/partners/isv-integrations/amberflo","permalink":"/sbt-aws/docs/partners/isv-integrations/amberflo","draft":false,"unlisted":false,"editUrl":"https://github.com/awslabs/sbt-aws/blob/main/website/docs/partners/isv-integrations/amberflo.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Amberflo","description":"A cloud-native solution that integrates with SaaS products to enable real-time metering and usage-based billing for GenAI and SaaS applications.","hide_table_of_contents":false,"sidebar_position":1},"sidebar":"partnerIntegrations","previous":{"title":"ISV Partner Integrations","permalink":"/sbt-aws/docs/category/isv-partner-integrations"},"next":{"title":"Descope","permalink":"/sbt-aws/docs/partners/isv-integrations/descope"}}');var a=t(4848),i=t(8453);const s={title:"Amberflo",description:"A cloud-native solution that integrates with SaaS products to enable real-time metering and usage-based billing for GenAI and SaaS applications.",hide_table_of_contents:!1,sidebar_position:1},o="Introduction",l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Obtaining the Plugin",id:"obtaining-the-plugin",level:2},{value:"Installation Steps",id:"installation-steps",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Add AmberfloMetering to Your Control Plane",id:"add-amberflometering-to-your-control-plane",level:3},{value:"Provision a Meter",id:"provision-a-meter",level:3},{value:"Update a Meter",id:"update-a-meter",level:3},{value:"Get a Meter",id:"get-a-meter",level:3},{value:"List all Meters",id:"list-all-meters",level:3},{value:"Delete a Meter",id:"delete-a-meter",level:3},{value:"Ingest Usage Events",id:"ingest-usage-events",level:3},{value:"Fetch Usage Data",id:"fetch-usage-data",level:3},{value:"Canceling incorrect usage events",id:"canceling-incorrect-usage-events",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Contributing",id:"contributing",level:2}];function d(e){const n={a:"a",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"introduction",children:"Introduction"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://www.amberflo.io/",children:"Amberflo"})," is a cloud-based platform designed to help businesses implement and manage metering, usage-based billing, and analytics for their SaaS (Software as a Service) products and services. Amberflo offers a robust platform for real-time tracking, metering and billing of usage events such as LLM tokens, API transactions, and consumption of compute, storage, and network resources, enabling precise billing based on actual usage. Whether you\u2019re managing a subscription-based business model or billing customers per unique user, Amberflo\u2019s billing cloud streamlines the invoicing process and integrates seamlessly with popular payment gateways like Stripe or ERP systems like Netsuite, ensuring smooth, automated customer invoicing and payment collection."]}),"\n",(0,a.jsx)(n.p,{children:"This module enables precise near real-time metering and usage based billing for any Data platforms, SaaS or AI applications. It extends AWS SaaS Builder ToolKit (SBT) capability by integrating Amberflo\u2019s cloud native solution to enable builders to track, meter and bill usage events such as LLM tokens, API transactions, and consumption of compute, storage, and network resources in near real-time. With this integration, you can effortlessly implement a modern, usage-based billing for your SaaS and GenAI applications out-of-the-box."}),"\n",(0,a.jsx)(n.h1,{id:"installation-instructions",children:"Installation instructions"}),"\n",(0,a.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Deploy a SBT Project: If you don't already have a SBT project deployed, follow AWS SBT's tutorial\nto deploy the sample hello-cdk project with a ControlPlane and CoreApplicationPlane."}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Amberflo Account: You need an Amberflo account for this project. If you don\u2019t have an Amberflo\naccount, you can sign up for one here: ",(0,a.jsx)(n.a,{href:"https://www.amberflo.io/aws-saas-factory",children:"Amberflo Signup"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"API Key Secret: After signing up, the Amberflo API Key must be stored as a secret in AWS Secrets\nManager. The application by default expects the secret to be created with the name\nAmberfloApiKey. However, you can create a secret with your own custom name and pass it in as a\nparameter to AmberfloMetering."}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"Secret Name:"})," The name of the secret in AWS Secrets Manager",(0,a.jsx)(n.br,{}),"\n",(0,a.jsx)(n.code,{children:"Secret Key:"})," The key within the secret JSON that contains the API Key"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"obtaining-the-plugin",children:"Obtaining the Plugin"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.em,{children:"Option 1:"})," Clone the repository"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"git clone https://github.com/amberflo/sbt-aws-amberflo.git"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.em,{children:"Option 2:"})," Download the latest release\nVisit the ",(0,a.jsx)(n.a,{href:"https://github.com/amberflo/sbt-aws-amberflo/releases",children:"sbt-aws-amberflo releases"})," and download the latest version."]}),"\n",(0,a.jsx)(n.h2,{id:"installation-steps",children:"Installation Steps"}),"\n",(0,a.jsx)(n.p,{children:"Within your SBT project directory, install aws-sbt-amberflo via the following command:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"npm install --save sbt-aws-amberflo"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"amberflo-architecture.webp",src:t(5883).A+"",width:"800",height:"450"})}),"\n",(0,a.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,a.jsx)(n.h3,{id:"add-amberflometering-to-your-control-plane",children:"Add AmberfloMetering to Your Control Plane"}),"\n",(0,a.jsx)(n.p,{children:"Instantiate the AmberfloMetering construct in your AWS CDK stack. Here\u2019s an example TypeScript code snippet:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { Stack } from 'aws-cdk-lib';\nimport { Construct } from 'constructs';\nimport * as sbt from '@cdklabs/sbt-aws';\nimport { AmberfloMetering } from 'sbt-aws-amberflo';\n\nexport class ControlPlaneStack extends Stack {\n  constructor(scope: Construct, id: string, props: any) {\n    super(scope, id, props);\n\n    const amberfloMetering = new AmberfloMetering(this, 'AmberfloMetering', {\n      amberfloAPIKeySecretName: 'YourSecretName', \n      amberfloAPIKeySecretId: 'YourSecretId', \n    });\n\n    const controlPlane = new sbt.ControlPlane(this, 'ControlPlane', {\n      metering: amberfloMetering,\n    });\n  }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"provision-a-meter",children:"Provision a Meter"}),"\n",(0,a.jsx)(n.p,{children:"Once you deploy your updated stack, you can create and manage meters using the provided API endpoints. Here\u2019s how you can create a meter:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'METER=$(jq --null-input \\\n\'{\n  "label": "SBT Meter",\n  "meterApiName": "sbt-meter",\n  "meterType": "sum_of_all_usage"\n}\')\n\necho "creating meter..."\ncurl --request POST \\\n    --url "${CONTROL_PLANE_API_ENDPOINT}meters" \\\n    --header "Authorization: Bearer ${ACCESS_TOKEN}" \\\n    --header \'content-type: application/json\' \\\n    --data "$METER" | jq\n'})}),"\n",(0,a.jsx)(n.p,{children:"The above 3 properties are the required properties for creating a meter. You can also pass in additional properties while creating a meter. See more on creating meters in Amberflo."}),"\n",(0,a.jsx)(n.h3,{id:"update-a-meter",children:"Update a Meter"}),"\n",(0,a.jsx)(n.p,{children:"Once you deploy your updated stack, you can update meters using the provided API endpoint. Here\u2019s how you can update a meter:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'UPDATE_METER=$(jq --null-input \\\n\'{\n  "label": "SBT trial meter",\n  "meterApiName": "sbt-trial",\n  "meterType": "sum_of_all_usage"\n}\')\n\necho "updating meter..."\ncurl --request PUT \\\n    --url "${CONTROL_PLANE_API_ENDPOINT}meters/<meter-id>" \\\n    --header "Authorization: Bearer ${ACCESS_TOKEN}" \\\n    --header \'content-type: application/json\' \\\n    --data "$UPDATE_METER" | jq\n\n'})}),"\n",(0,a.jsx)(n.h3,{id:"get-a-meter",children:"Get a Meter"}),"\n",(0,a.jsx)(n.p,{children:"You can get a meter by id using the provided API endpoint. Here\u2019s how you can get a meter:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'curl --request GET \\\n    --url "${CONTROL_PLANE_API_ENDPOINT}meters/<meterId>" \\\n    --header "Authorization: Bearer ${ACCESS_TOKEN}" \\\n    --silent | jq\n'})}),"\n",(0,a.jsx)(n.h3,{id:"list-all-meters",children:"List all Meters"}),"\n",(0,a.jsx)(n.p,{children:"You can list all meters using the provided API endpoint. Here\u2019s how you can list all meter:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'curl --request GET \\\n    --url "${CONTROL_PLANE_API_ENDPOINT}meters/<meterId>" \\\n    --header "Authorization: Bearer ${ACCESS_TOKEN}" \\\n    --silent | jq\n'})}),"\n",(0,a.jsx)(n.h3,{id:"delete-a-meter",children:"Delete a Meter"}),"\n",(0,a.jsx)(n.p,{children:"You can delete a meter by id using the provided API endpoint. Here\u2019s how you can delete a meter:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'curl --request DELETE \\\n    --url "${CONTROL_PLANE_API_ENDPOINT}meters/<meterId>" \\\n    --header "Authorization: Bearer ${ACCESS_TOKEN}" \\\n    --silent | jq\n'})}),"\n",(0,a.jsx)(n.h3,{id:"ingest-usage-events",children:"Ingest Usage Events"}),"\n",(0,a.jsx)(n.p,{children:"To ingest usage events, application or service in the application plane must emit events that represent usage metrics, which will be processed by the ingestUsageEventFunction Lambda function."}),"\n",(0,a.jsx)(n.p,{children:"Event details must contain the following required properties:\n\u25cf\ttenantId: The identifier of the tenant to associate with the usage.\n\u25cf\tmeterApiName: The name of the meter as used in the createMeter.\n\u25cf\tmeterValue: The quantity or amount of usage to record for a tenant.\nThese properties are necessary to accurately track and attribute usage metrics. You can also pass in additional values for dimensions, if the meter has dimensions defined."}),"\n",(0,a.jsx)(n.p,{children:"Example"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'const putEventsResponse = eventManager.eventBus.putEvents({\n  entries: [{\n    detail: {\n      "tenantId": <tenantId>,\n      "meterApiName": <meterApiName as used in create meter>,\n      "meterValue": <usage value that is to be recorded>\n    },\n    detailType: DetailType.INGEST_USAGE,\n    source: eventManager.applicationPlaneEventSource,\n  }],\n});\n'})}),"\n",(0,a.jsx)(n.p,{children:"The ingestUsageEventFunction Lambda function will be triggered to handle this event and send the data to Amberflo for processing."}),"\n",(0,a.jsx)(n.p,{children:"Note: the eventManager is the eventManager passed to the CoreApplicationPlane"}),"\n",(0,a.jsx)(n.h3,{id:"fetch-usage-data",children:"Fetch Usage Data"}),"\n",(0,a.jsx)(n.p,{children:"To fetch usage data, use the API endpoint to retrieve data based on your meter API name:\nExample"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'METER_API_NAME = \'sbt-meter\'\nSTART_TIME = 1724630400\nEND_TIME = 1724716800\n\ncurl --request GET \\\n    --url "${CONTROL_PLANE_API_ENDPOINT}usage/<meterId>?meterApiName=${METER_API_NAME}&startTimeInSeconds=${START_TIME}&endTimeInSeconds=${END_TIME}" \\\n    --header "Authorization: Bearer ${ACCESS_TOKEN}" \\\n    --silent | jq\n'})}),"\n",(0,a.jsx)(n.p,{children:"The meterApiName id not provided in the query string will be fetched using the meterId path parameter. The startTimeInSeconds and endTimeInSeconds are optional and default to (current time - 24hrs) and current time."}),"\n",(0,a.jsx)(n.h3,{id:"canceling-incorrect-usage-events",children:"Canceling incorrect usage events"}),"\n",(0,a.jsx)(n.p,{children:"There are occasions where a meter event source may send or report incorrect or erroneous meters. Amberflo provides the ability to cancel (undo) one or more meter events as needed. See detailed guide on canceling usage events.\nExample"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'FILTER=$(jq --null-input \\\n\'{\n  "id": "sbt-filtering-rule",\n  "meterApiName": "sbt-trial",\n  "ingestionTimeRange": {\n    "startTimeInSeconds": 1724367600,\n    "endTimeInSeconds": 1724371200\n  }\n}\')\n\necho "creating filtering rule for canceling usage events..."\ncurl --request DELETE \\\n    --url "${CONTROL_PLANE_API_ENDPOINT}usage" \\\n    --header "Authorization: Bearer ${ACCESS_TOKEN}" \\\n    --header \'content-type: application/json\' \\\n    --data "$FILTER" | jq\n'})}),"\n",(0,a.jsx)(n.p,{children:"The id, meterApiName and ingestionTimeRange are required parameters.\nThe above command creates a filtering rule that cancels the events for the meter sbt-trial in the given time range. You can also cancel more specific events for specific tenants or based on specific dimensions etc. See the Amberflo API for more details."}),"\n",(0,a.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,a.jsx)(n.p,{children:"The Amberflo metering implementation provided in this repository allows ISVs to integrate Amberflo with their SBT-based applications. This enables ISVs to:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Track and analyze usage metrics for their tenants"}),"\n",(0,a.jsx)(n.li,{children:"Create a more accurate and efficient billing process"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"The AmberfloMetering construct deploys an AWS Lambda function to handle usage metering. It also provides a set of APIs for creating and updating meters, fetching usage, as well as ingesting usage events and canceling usage events. SaaS admins can use these endpoints for managing the application metering.\nThe following endpoints are created in the control plane"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Create Meter: POST /meters\nUpdate Meter: PUT /meters/{meterId}\nIngest Usage: POST /ingest\nCancel Usage: DELETE /usage\nFetch Usage: GET /usage/meterId\n"})}),"\n",(0,a.jsx)(n.p,{children:"Here's a brief overview of how this works:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Meter Creation: SaaS admins can create meters through the create meter API in control plane or through the Amberflo UI."}),"\n",(0,a.jsx)(n.li,{children:"Event Emission: Your application or service emits an ingest usage event with the necessary details to measure usage for a specific meter."}),"\n",(0,a.jsx)(n.li,{children:"Lambda Invocation: The ingestUsageEventFunction of AmberfloMetering is invoked automatically upon receiving the event."}),"\n",(0,a.jsx)(n.li,{children:"Data Processing: The Lambda function processes the event data and sends it to Amberflo for recording and subsequent usage analysis."}),"\n",(0,a.jsx)(n.li,{children:"Fetch Usage: SaaS admins can fetch usage through the fetch usage API in control plane or through the Amberflo UI."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"contributing",children:"Contributing"}),"\n",(0,a.jsx)(n.p,{children:"We welcome contributions to improve the plugin! Please follow these steps:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:'Fork the Repository: Click the "Fork" button on the repository page to create your own copy.'}),"\n",(0,a.jsx)(n.li,{children:"Create a Branch:\nCreate a new branch for your feature or bug fix\ngit checkout -b my-feature-branch"}),"\n",(0,a.jsx)(n.li,{children:"Make Changes: Implement your feature or bug fix while adhering to existing coding standards."}),"\n",(0,a.jsx)(n.li,{children:"Write Tests: Add tests if applicable."}),"\n",(0,a.jsx)(n.li,{children:'Commit Your Changes:\ngit commit -m "Add feature X or fix issue Y"'}),"\n",(0,a.jsx)(n.li,{children:"Push to Your Fork:\ngit push origin my-feature-branch"}),"\n",(0,a.jsx)(n.li,{children:"Submit a Pull Request: Open a pull request in the original repository with a clear description of your changes."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},5883:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/amberflo-architecture-bb8aaab1d36114c393848218b46100fd.webp"},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var r=t(6540);const a={},i=r.createContext(a);function s(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);