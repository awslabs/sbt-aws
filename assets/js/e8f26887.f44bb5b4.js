"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7637],{6860:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"tutorials/tutorial-basics/test-the-deployment","title":"Testing the deployment","description":"Once deployed, let\'s run a few tests to see our basic control plane and application plane in action. When you deployed the control plane, you should\'ve received an email with temporary admin credentials. Let\'s use those credentials now to log in to that account. Please replace the placeholder (\'INSERT PASSWORD HERE\') with your temporary password in the script below. Once logged in, this script will onboard a new tenant, and retrieve its details. Note this script uses the jq JSON processor.","source":"@site/docs/tutorials/tutorial-basics/test-the-deployment.md","sourceDirName":"tutorials/tutorial-basics","slug":"/tutorials/tutorial-basics/test-the-deployment","permalink":"/sbt-aws/docs/tutorials/tutorial-basics/test-the-deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/awslabs/sbt-aws/blob/main/website/docs/tutorials/tutorial-basics/test-the-deployment.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9},"sidebar":"tutorialSidebar","previous":{"title":"Putting it all together","permalink":"/sbt-aws/docs/tutorials/tutorial-basics/putting-it-all-together"},"next":{"title":"Congratulations!","permalink":"/sbt-aws/docs/tutorials/tutorial-basics/congratulations"}}');var a=n(4848),s=n(8453);const i={sidebar_position:9},r="Testing the deployment",l={},c=[];function u(e){const t={a:"a",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"testing-the-deployment",children:"Testing the deployment"})}),"\n",(0,a.jsx)(t.p,{children:"Once deployed, let's run a few tests to see our basic control plane and application plane in action. When you deployed the control plane, you should've received an email with temporary admin credentials. Let's use those credentials now to log in to that account. Please replace the placeholder ('INSERT PASSWORD HERE') with your temporary password in the script below. Once logged in, this script will onboard a new tenant, and retrieve its details. Note this script uses the jq JSON processor."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:'PASSWORD=\'INSERT PASSWORD HERE\'\n# Change this to a real email if you\'d like to log into the tenant\nTENANT_EMAIL="tenant@example.com"\nCONTROL_PLANE_STACK_NAME="ControlPlaneStack"\nTENANT_NAME="tenant$RANDOM"\n\nCLIENT_ID=$(aws cloudformation describe-stacks \\\n  --stack-name "$CONTROL_PLANE_STACK_NAME" \\\n  --query "Stacks[0].Outputs[?OutputKey==\'ControlPlaneIdpClientId\'].OutputValue" \\\n  --output text)\n\nUSER_POOL_ID=$(aws cloudformation describe-stacks \\\n  --stack-name "$CONTROL_PLANE_STACK_NAME" \\\n  --query "Stacks[0].Outputs[?OutputKey==\'ControlPlaneIdpUserPoolId\'].OutputValue" \\\n  --output text)\n\nUSER="admin"\n\n# required in order to initiate-auth\naws cognito-idp update-user-pool-client \\\n    --user-pool-id "$USER_POOL_ID" \\\n    --client-id "$CLIENT_ID" \\\n    --explicit-auth-flows USER_PASSWORD_AUTH\n\n# remove need for password reset\naws cognito-idp admin-set-user-password \\\n    --user-pool-id "$USER_POOL_ID" \\\n    --username "$USER" \\\n    --password "$PASSWORD" \\\n    --permanent\n\n# get credentials for user\nAUTHENTICATION_RESULT=$(aws cognito-idp initiate-auth \\\n  --auth-flow USER_PASSWORD_AUTH \\\n  --client-id "${CLIENT_ID}" \\\n  --auth-parameters "USERNAME=\'${USER}\',PASSWORD=\'${PASSWORD}\'" \\\n  --query \'AuthenticationResult\')\n\nACCESS_TOKEN=$(echo "$AUTHENTICATION_RESULT" | jq -r \'.AccessToken\')\n\nCONTROL_PLANE_API_ENDPOINT=$(aws cloudformation describe-stacks \\\n    --stack-name "$CONTROL_PLANE_STACK_NAME" \\\n    --query "Stacks[0].Outputs[?contains(OutputKey,\'controlPlaneAPIEndpoint\')].OutputValue" \\\n    --output text)\n\nDATA=$(jq --null-input \\\n    --arg tenantName "$TENANT_NAME" \\\n    --arg tenantEmail "$TENANT_EMAIL" \\\n    \'{\n  "tenantName": $tenantName,\n  "email": $tenantEmail,\n  "tier": "basic",\n  "tenantStatus": "In progress"\n}\')\n\necho "creating tenant..."\ncurl --request POST \\\n    --url "${CONTROL_PLANE_API_ENDPOINT}tenants" \\\n    --header "Authorization: Bearer ${ACCESS_TOKEN}" \\\n    --header \'content-type: application/json\' \\\n    --data "$DATA" | jq\necho "" # add newline\n\necho "retrieving tenants..."\ncurl --request GET \\\n    --url "${CONTROL_PLANE_API_ENDPOINT}tenants" \\\n    --header "Authorization: Bearer ${ACCESS_TOKEN}" \\\n    --silent | jq\n'})}),"\n",(0,a.jsx)(t.p,{children:"Now that we've onboarded a tenant, let's take a look at the console to see what got deployed."}),"\n",(0,a.jsxs)(t.p,{children:["First, let's open the ",(0,a.jsx)(t.a,{href:"https://console.aws.amazon.com/dynamodbv2/home#",children:"DynamoDB console"}),'. Once open, click the Explore Items link on the left. On the "Tables" screen, select the table that starts with ',(0,a.jsx)(t.code,{children:"ControlPlaneStack"}),'. Notice there is an entry for the tenant we just onboarded. Also notice it\'s probably still "in progress"']}),"\n",(0,a.jsxs)(t.p,{children:["Recall that we deployed a ",(0,a.jsx)(t.code,{children:"ScriptJob"})," with our application plane, and it's a wrapper around an AWS Step Function that runs our provisioning script via CodeBuild. Let's take a look at that Step Function now by clicking navigating to Step Functions in the console (ensure you're in the same region you deployed to)."]}),"\n",(0,a.jsx)(t.p,{children:"The Step Function is likely still running, but feel free to examine the execution. Once finished, it'll return the results back to EventBridge, and close the loop with the Control plane."})]})}function d(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>r});var o=n(6540);const a={},s=o.createContext(a);function i(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);