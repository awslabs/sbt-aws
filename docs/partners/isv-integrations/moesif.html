<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-partners/isv-integrations/moesif" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Moesif | SaaS Builder Toolkit for AWS (SBT-AWS)</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://awslabs.github.io/sbt-aws/docs/partners/isv-integrations/moesif"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Moesif | SaaS Builder Toolkit for AWS (SBT-AWS)"><meta data-rh="true" name="description" content="Provides usage-based billing support for SBT"><meta data-rh="true" property="og:description" content="Provides usage-based billing support for SBT"><link data-rh="true" rel="icon" href="/sbt-aws/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://awslabs.github.io/sbt-aws/docs/partners/isv-integrations/moesif"><link data-rh="true" rel="alternate" href="https://awslabs.github.io/sbt-aws/docs/partners/isv-integrations/moesif" hreflang="en"><link data-rh="true" rel="alternate" href="https://awslabs.github.io/sbt-aws/docs/partners/isv-integrations/moesif" hreflang="x-default"><link rel="stylesheet" href="/sbt-aws/assets/css/styles.cb016cba.css">
<script src="/sbt-aws/assets/js/runtime~main.4452c180.js" defer="defer"></script>
<script src="/sbt-aws/assets/js/main.01a2ea14.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/sbt-aws/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/sbt-aws/"><div class="navbar__logo"><img src="/sbt-aws/img/logo.svg" alt="sbt logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/sbt-aws/img/logo.svg" alt="sbt logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">SBT-AWS</b></a><a class="navbar__item navbar__link" href="/sbt-aws/docs/category/sbt-tutorial---basics">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/sbt-aws/docs/category/isv-partner-integrations">Integrations</a><a class="navbar__item navbar__link" href="/sbt-aws/docs/interfaces">Interfaces</a><a class="navbar__item navbar__link" href="/sbt-aws/docs/reference_architectures/eks-reference-architecture">Reference Architectures</a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/sbt-aws/docs/category/isv-partner-integrations">ISV Partner Integrations</a><button aria-label="Collapse sidebar category &#x27;ISV Partner Integrations&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sbt-aws/docs/partners/isv-integrations/amberflo">Amberflo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sbt-aws/docs/partners/isv-integrations/descope">Descope</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/sbt-aws/docs/partners/isv-integrations/moesif">Moesif</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sbt-aws/docs/partners/marketplace-integration">Marketplace</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/sbt-aws/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/sbt-aws/docs/category/isv-partner-integrations"><span itemprop="name">ISV Partner Integrations</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Moesif</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Moesif API Monetization for AWS SBT</h1></header>
<p>This module extends the AWS SaaS Builder Toolkit (SBT) to support usage-based billing through Moesif.</p>
<p><a href="https://www.moesif.com/" target="_blank" rel="noopener noreferrer">Moesif API Monetization</a> provides a cloud-based solution for <a href="https://www.moesif.com/solutions/metered-api-billing" target="_blank" rel="noopener noreferrer">usage-based billing</a> such as billing on API transactions, compute resources, or unique users. Then, you can invoice and collect payments automatically through popular payment providers like Stripe, Zuora, or custom invoicing solutions.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-works">How it works<a href="#how-it-works" class="hash-link" aria-label="Direct link to How it works" title="Direct link to How it works">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="event-ingestion">Event Ingestion<a href="#event-ingestion" class="hash-link" aria-label="Direct link to Event Ingestion" title="Direct link to Event Ingestion">​</a></h3>
<p>The project deploys an <a href="https://docs.aws.amazon.com/firehose/latest/dev/what-is-this-service.html" target="_blank" rel="noopener noreferrer">Amazon Data Firehose</a> to ingest your raw usage events. Events can be API Calls such as from an Amazon API Gateway instance or custom actions triggered within your application. The firehose will send all events to Moesif&#x27;s Collection API for metering and analytics.</p>
<p><img decoding="async" loading="lazy" alt="moesif-firehose-diagram.png" src="/sbt-aws/assets/images/moesif-firehose-diagram-c3fcee72e3d6e26029b08e2044abe234.png" width="1930" height="752" class="img_ev3q"></p>
<p>For more info on how the <code>MoesifFirehoseConstruct</code> works, view <a href="https://www.moesif.com/docs/ingest-action-events/aws-firehose/" target="_blank" rel="noopener noreferrer">Moesif docs on ingesting actions via Firehose</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="user-and-tenant-management">User and Tenant Management<a href="#user-and-tenant-management" class="hash-link" aria-label="Direct link to User and Tenant Management" title="Direct link to User and Tenant Management">​</a></h3>
<p>The project also deploys a <a href="https://aws.amazon.com/lambda/" target="_blank" rel="noopener noreferrer">Lambda Function</a> for user and tenant management. The lambda will listen to events like <code>provisionSuccess</code> to create companies and subscriptions in Moesif and your payment provider. Similarly, when receiving a <code>deprovisionSuccess</code> event, all subscriptions will be canceled for the tenant. You can <a href="https://github.com/Moesif/sbt-aws-moesif/tree/master/resources/functions/billing_management" target="_blank" rel="noopener noreferrer">inspect the code here</a>.</p>
<table><thead><tr><th>SBT Entity</th><th>Moesif Entity</th><th>Description</th><th>Parent</th></tr></thead><tbody><tr><td>Tenant</td><td>Company</td><td>Your customer that you provisioned resources for.</td><td>None</td></tr><tr><td>Tenant</td><td>Subscription</td><td>A single subscription for a company/tenant.</td><td>Company</td></tr><tr><td>User</td><td>User</td><td>End users of your customer who login to your SaaS.</td><td>Company</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-use">How to use<a href="#how-to-use" class="hash-link" aria-label="Direct link to How to use" title="Direct link to How to use">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3>
<ol>
<li>If you don&#x27;t already have a SBT project deployed, follow <a href="https://github.com/awslabs/sbt-aws/tree/main/docs/public" target="_blank" rel="noopener noreferrer">AWS SBT&#x27;s tutorial</a> to deploy the sample <code>hello-cdk</code> project with a <code>ControlPlane</code> and <code>CoreApplicationPlane</code>.</li>
<li>You already have a Moesif account. You can sign up for a trial on <a href="https://www.moesif.com/" target="_blank" rel="noopener noreferrer">moesif.com</a></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-install-the-npm-package">1. Install the NPM package<a href="#1-install-the-npm-package" class="hash-link" aria-label="Direct link to 1. Install the NPM package" title="Direct link to 1. Install the NPM package">​</a></h3>
<p>Within your SBT project directory, install <code>sbt-aws-moesif</code> via the following command:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm install --save sbt-aws-moesif</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-add-moesifbilling-to-your-controlplane">2. Add MoesifBilling to your ControlPlane<a href="#2-add-moesifbilling-to-your-controlplane" class="hash-link" aria-label="Direct link to 2. Add MoesifBilling to your ControlPlane" title="Direct link to 2. Add MoesifBilling to your ControlPlane">​</a></h3>
<p>Instantiate the <a href="https://github.com/Moesif/sbt-aws-moesif/blob/master/lib/moesif-billing.ts" target="_blank" rel="noopener noreferrer">MoesifBilling</a> construct like below. You will need to set some properties to authenticate with Moesif.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ControlPlaneStack</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">Stack</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> regApiGatewayUrl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">readonly</span><span class="token plain"> eventBusArn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scope</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Construct</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scope</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> props</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> cognitoAuth </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">CognitoAuth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;CognitoAuth&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      idpName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;COGNITO&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      systemAdminRoleName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;SystemAdmin&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      systemAdminEmail</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;&lt;Your Admin Email&gt;&gt;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> moesifBilling </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">MoesifBilling</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">stack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;MoesifBilling&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      moesifApplicationId</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;&lt;Your Moesif Application Id&gt;&gt;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      moesifManagementAPIKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;&lt;Your Moesif Management API Key&gt;&gt;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      billingProviderSlug</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> BillingProviderSlug</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">STRIPE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      billingProviderSecretKey</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;&lt;Your Billing Provider\&#x27;s Secret Such as for Stripe&gt;&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> controlPlane </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ControlPlane</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ControlPlane&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      auth</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> cognitoAuth</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      billing</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> moesifBilling</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">eventBusArn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> controlPlane</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">eventBusArn</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">regApiGatewayUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> controlPlane</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">controlPlaneAPIGatewayUrl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="moesif-billing-properties">Moesif Billing Properties<a href="#moesif-billing-properties" class="hash-link" aria-label="Direct link to Moesif Billing Properties" title="Direct link to Moesif Billing Properties">​</a></h3>
<table><thead><tr><th>Property Name</th><th>Type</th><th>Required</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td>moesifApplicationId</td><td>string</td><td>Required</td><td>Collector Application Id from your Moesif account for event ingestion</td><td></td></tr><tr><td>moesifManagementAPIKey</td><td>string</td><td>Required</td><td>Management API Key from your Moesif account. The key must have the following scopes: create<!-- -->:companies<!-- --> create<!-- -->:subscriptions<!-- --> create<!-- -->:users<!-- --> delete<!-- -->:companies<!-- -->  delete<!-- -->:subscriptions<!-- --> delete<!-- -->:users</td><td></td></tr><tr><td>moesifManagementAPIBaseUrl</td><td>string</td><td></td><td>Override the base URL for the Moesif Mangaement API. For most setups, you don&#x27;t need to set this.</td><td><a href="https://api.moesif.com" target="_blank" rel="noopener noreferrer">https://api.moesif.com</a></td></tr><tr><td>moesifCollectorAPIBaseUrl</td><td>string</td><td></td><td>Override the base URL for the Moesif Collector API. For most setups, you don&#x27;t need to set this.</td><td><a href="https://api.moesif.net" target="_blank" rel="noopener noreferrer">https://api.moesif.net</a></td></tr><tr><td>billingProviderSlug</td><td>BillingProviderSlug</td><td>Required</td><td>Slug for Billing Provider / Payment Gateway</td><td></td></tr><tr><td>billingProviderSecretKey</td><td>string</td><td>Required</td><td>Secret Key for Billing Provider / Payment Gateway selected by billingProviderSlug</td><td></td></tr><tr><td>billingProviderClientId</td><td>string</td><td>Only if Zuora</td><td>Client Id for Billing Provider / Payment Gateway. Only used when billingProviderSlug is Zuora</td><td></td></tr><tr><td>billingProviderBaseUrl</td><td>string</td><td>Only if Chargebee or Zuora</td><td>Base URL for Billing Provider / Payment Gateway. Only used when billingProviderSlug is Zuora or Chargebee</td><td></td></tr><tr><td>tenantPlanField</td><td>string</td><td></td><td>Tenant object&#x27;s field name that contains the plan id used when creating new subscriptions. Only used when billingProviderSlug is Zuora</td><td>planId</td></tr><tr><td>tenantPriceField</td><td>string</td><td></td><td>Tenant object&#x27;s field name that contains the price id used when creating new subscriptions.</td><td>priceId</td></tr><tr><td>firehoseName</td><td>string</td><td></td><td>The name of the Kinesis Firehose delivery stream. By default, a unique name will be generated.</td><td></td></tr><tr><td>bucketName</td><td>string</td><td></td><td>The name of the S3 bucket for backup. By default, a unique name will be generated.</td><td></td></tr><tr><td>schema</td><td>string</td><td></td><td>Moesif Event Schema for data ingestion. By default, Moesif actions</td><td></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-provision-a-tenant">3. Provision a Tenant<a href="#3-provision-a-tenant" class="hash-link" aria-label="Direct link to 3. Provision a Tenant" title="Direct link to 3. Provision a Tenant">​</a></h3>
<p>Once you deploy your updated stack, create a tenant in your AWS SBT setup using the SBT APIs.</p>
<p>When you create a tenant, you must also set the price id to be used for creating subscriptions, By default, the field name is <code>priceId</code>, but this can be overridden via the above options. If you are using Zuora, you must also set the plan id. The field <code>email</code> must also be set.</p>
<p><em>If your provider is set to Zuora, <a href="#zuora">you must also set these fields</a></em></p>
<p>If you&#x27;re running the <code>hello-cdk</code> project, this can be done by running <a href="https://github.com/awslabs/sbt-aws/tree/main/docs/public#test-the-deployment" target="_blank" rel="noopener noreferrer">this script</a> to onboard a new tenant. Modify, the script to also include the price (and plan if required).</p>
<blockquote>
<p>To find your plan id and price id, you can log into Moesif UI and go to Product Catalog or log into your billing provider.</p>
</blockquote>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DATA=$(jq --null-input \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --arg tenantEmail &quot;$TENANT_EMAIL&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --arg tenantId &quot;$TENANT_ID&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;email&quot;: $tenantEmail,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;tenantId&quot;: $tenantId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;priceId&quot;: &quot;price_1MoBy5LkdIwHu7ixZhnattbh&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;creating tenant...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl --request POST \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --url &quot;${CONTROL_PLANE_API_ENDPOINT}tenants&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --header &quot;Authorization: Bearer ${ID_TOKEN}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --header &#x27;content-type: application/json&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --data &quot;$DATA&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Once done, you should see the company show up in the Moesif UI. There should also be a subscription for the company in the &quot;active&quot; status.</p>
<p>The tenant will be subscribed to the price defined by <code>defaultPriceId</code>.
This can be expanded to allow more customization.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-ingest-events">4. Ingest Events<a href="#4-ingest-events" class="hash-link" aria-label="Direct link to 4. Ingest Events" title="Direct link to 4. Ingest Events">​</a></h3>
<p>Now that you created a tenant, you should ingest some actions in you&#x27;re newly created firehose. Actions have an action name (like &quot;Signed Up&quot;, &quot;API Request&quot;, or &quot;Finished Job&quot;) which represents the usage event. You can also include arbitrary metadata with an action, which enables you to create billable metrics, usage reporting, and more. For more info, <a href="https://www.moesif.com/docs/getting-started/user-actions/" target="_blank" rel="noopener noreferrer">see docs on actions</a></p>
<p>You&#x27;ll want to set a few fields like below:</p>
<ul>
<li><code>action_name</code> is a string and should include name of the event such as &quot;Processed Payment Transaction&quot;</li>
<li><code>company_id</code> is your tenant identifier. <a href="https://www.moesif.com/docs/getting-started/companies/" target="_blank" rel="noopener noreferrer">See companies</a></li>
<li><code>transaction_id</code> should be a random UUID for this event which Moesif uses for deduplication. <a href="https://www.moesif.com/docs/api#idempotency" target="_blank" rel="noopener noreferrer">Docs on Moesif idempotency</a>.</li>
<li><code>request.time</code> represents the transaction time as an ISO formatted string.</li>
<li><code>metadata</code> is an object which includes any custom properties for this event. By setting metadata, you can bill on arbitrary metrics, create metrics on them, etc. For example, if the action name is &quot;Processed Payment Transaction&quot;, you can include an amount and the currency to bill on the total amount.</li>
</ul>
<p>For full schema and available fields, see <a href="https://www.moesif.com/docs/api#track-user-actions-in-batch" target="_blank" rel="noopener noreferrer">Actions API Reference</a></p>
<p>An example action is below:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;action_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Processed Payment Transaction&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;request&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2024-03-01T04:45:42.914&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;company_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;12345&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// This is your tenant id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;transaction_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;a3765025-46ec-45dd-bc83-b136c8d1d257&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;metadata&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;amount&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">24.6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;currency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;USD&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;time_seconds&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">66.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the above example, the action is created whenever a payment is processed. There are also two metrics we are tracking as part of the action (the amount of the payment and how long the job took). You can create billable metrics and usage reports from these attributes.</p>
<blockquote>
<p>If your events are API calls, we recommend changing the MoesifEventSchema to <code>API_CALL</code> which provides a different schema than the above actions. See <a href="https://www.moesif.com/docs/api?int_source=docs#api-calls" target="_blank" rel="noopener noreferrer">API Calls</a></p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-create-a-billing-meter">5. Create a Billing Meter<a href="#5-create-a-billing-meter" class="hash-link" aria-label="Direct link to 5. Create a Billing Meter" title="Direct link to 5. Create a Billing Meter">​</a></h3>
<p>Now that the tenant is created, follow <a href="https://www.moesif.com/docs/metered-billing/creating-billing-meters/" target="_blank" rel="noopener noreferrer">these steps</a> to create a billing meter in Moesif. The billing meter can filter or aggregate on any of the metadata fields you included with your action.</p>
<p>You should also select the provider and price defined by <code>billingProviderSlug</code> and <code>defaultPriceId</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="provider-specific-requirements">Provider Specific Requirements<a href="#provider-specific-requirements" class="hash-link" aria-label="Direct link to Provider Specific Requirements" title="Direct link to Provider Specific Requirements">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="zuora">Zuora<a href="#zuora" class="hash-link" aria-label="Direct link to Zuora" title="Direct link to Zuora">​</a></h3>
<p>If you are using Zuora, the following fields must be set when creating a new tenant:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;email&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;Customer email address&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;firstName&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;First name of customer contact&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;lastName&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;Last name of customer contact&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;currency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;Three-letter ISO currency code&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;address&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;state&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;State or providence of the contact&#x27;s address&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;country&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&lt;The country of the contact&#x27;s address&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="limitations">Limitations<a href="#limitations" class="hash-link" aria-label="Direct link to Limitations" title="Direct link to Limitations">​</a></h2>
<p><code>sbt-aws-moesif</code> is in preview. Development is still ongoing. There are limitations to be aware of.</p>
<ul>
<li>Deprovisioning a tenant will cancel all subscriptions but does not delete objects in case a subscription should be reactivated.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="useful-commands">Useful commands<a href="#useful-commands" class="hash-link" aria-label="Direct link to Useful commands" title="Direct link to Useful commands">​</a></h2>
<ul>
<li><code>npm run build</code>   compile typescript to js</li>
<li><code>npm run watch</code>   watch for changes and compile</li>
<li><code>npm run test</code>    perform the jest unit tests</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/awslabs/sbt-aws/blob/main/website/docs/partners/isv-integrations/moesif.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/sbt-aws/docs/partners/isv-integrations/descope"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Descope</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/sbt-aws/docs/partners/marketplace-integration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Marketplace</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-it-works" class="table-of-contents__link toc-highlight">How it works</a><ul><li><a href="#event-ingestion" class="table-of-contents__link toc-highlight">Event Ingestion</a></li><li><a href="#user-and-tenant-management" class="table-of-contents__link toc-highlight">User and Tenant Management</a></li></ul></li><li><a href="#how-to-use" class="table-of-contents__link toc-highlight">How to use</a><ul><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#1-install-the-npm-package" class="table-of-contents__link toc-highlight">1. Install the NPM package</a></li><li><a href="#2-add-moesifbilling-to-your-controlplane" class="table-of-contents__link toc-highlight">2. Add MoesifBilling to your ControlPlane</a></li><li><a href="#moesif-billing-properties" class="table-of-contents__link toc-highlight">Moesif Billing Properties</a></li><li><a href="#3-provision-a-tenant" class="table-of-contents__link toc-highlight">3. Provision a Tenant</a></li><li><a href="#4-ingest-events" class="table-of-contents__link toc-highlight">4. Ingest Events</a></li><li><a href="#5-create-a-billing-meter" class="table-of-contents__link toc-highlight">5. Create a Billing Meter</a></li></ul></li><li><a href="#provider-specific-requirements" class="table-of-contents__link toc-highlight">Provider Specific Requirements</a><ul><li><a href="#zuora" class="table-of-contents__link toc-highlight">Zuora</a></li></ul></li><li><a href="#limitations" class="table-of-contents__link toc-highlight">Limitations</a></li><li><a href="#useful-commands" class="table-of-contents__link toc-highlight">Useful commands</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/awslabs/sbt-aws/blob/main/docs/public/README.md#tutorial" target="_blank" rel="noopener noreferrer" class="footer__link-item">Tutorial<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Get Involved</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/awslabs/sbt-aws" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Built with ❤️ at AWS <br> © 2025 Amazon.com, Inc. or its affiliates. All Rights Reserved</div></div></div></footer></div>
</body>
</html>